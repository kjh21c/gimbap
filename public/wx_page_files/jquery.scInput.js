var _scCalculatorControl={};
(function(f){f.fn.listen=function(){return f.scInput.setInput(this)};f.scInput={setInput:function(a){var b=this;return a.each(function(){var a=f(this),d=b._loadOptions(a);if("textarea"!=this.type||!f.browser.msie||9<=parseFloat(f.browser.version))d.alignRight&&a.css("text-align","right"),a.attr("maxlength",d.maxLength),b._createWatermark(a,this.type,d),a.bind("focus",{element:b,settings:d,callEvent:b._onFocus},b._prepareEvent).bind("blur",{element:b,settings:d,callEvent:b._onBlur},b._prepareEvent).bind("keydown",
{element:b,settings:d,callEvent:b._onKeyDown},b._prepareEvent).bind("keyup",{element:b,settings:d,callEvent:b._onKeyUp},b._prepareEvent).bind("keypress",{element:b,settings:d,callEvent:b._onKeyPress},b._prepareEvent).bind("paste",{element:b,settings:d,callEvent:b._onPaste},b._preparePasteEvent)})},_onBlur:function(a,b){if("undefined"===typeof _scCalculatorControl||!_scCalculatorControl[b.$this.attr("id")])return this._applyWatermark(b.$this,b.$clone),b.isNumeric&&(sTestValue=this._removeCurrencySymbol(b.$this.val(),
b),sTestValue=this._removeNegativeSymbol(sTestValue,b),""==sTestValue&&b.$this.val("")),"decimal"!=b.datatype&&"currency"!=b.datatype||this._completeDecimal(b),b.inputFocusValue==b.$this.val()||this._isNotText(b._this)||b.$this.trigger("change"),!0},_onFocus:function(a,b){b.inputFocusValue=b.$this.val();b.selectOnFocus&&b.$this.select();return!0},_onKeyDown:function(a,b){b.isSpecial=null!=this.specialKeys[b.pressedKey]||a.ctrlKey||a.metaKey||a.altKey;return!0},_onKeyPress:function(a,b){if(this._isSpecialEnterTab(b)){var c=
this._goToNextElement(b);c&&a.preventDefault();return!0}if(this._isNotText(b._this))return!0;if(b.isSpecial)return this._isEnterSubmit(b,"enter")?"function"==typeof nm_submit_form?nm_submit_form():document.F1.submit():this._isEnterTab(b,"enter")&&(c=this._goToNextElement(b))&&a.preventDefault(),!0;a.preventDefault();b.originalValue=this._removeCurrencySymbol(b.originalValue,b);b.originalValue=this._removeNegativeSymbol(b.originalValue,b);this._checkDecimalsPress(b);b.originalValue=this._addNegativeSymbol(b.originalValue,
b);b.originalValue=this._addCurrencySymbol(b.originalValue,b);if(-1<f.inArray(b.pressedChar,b.maskCharsArray)&&!b.forceMask)return!0;b.newValue=this._removeCurrencySymbol(this._getNewValue(b),b);b.newValue=this._removeNegativeSymbol(b.newValue,b);b.maskedValue=this._maskValue(b);b.maskedValue=this._addNegativeSymbol(b.maskedValue,b);b.maskedValue=this._addCurrencySymbol(b.maskedValue,b);b.$this.val(b.maskedValue);this._setRange(b._this,b.maskedValue.length-b.charsFromRight);this._checkCurrencyRange(b);
b.forceMask=!1;b.forceDecimalPos=!1;return!0},_onKeyUp:function(a,b){if(b.isSpecial&&8!=b.pressedKey&&46!=b.pressedKey||this._isNotText(b._this))return!0;b.newValue=b.isSpecial?this._getNewValue(b):b.originalValue;b.newValue=this._removeCurrencySymbol(b.newValue,b);b.newValue=this._removeNegativeSymbol(b.newValue,b);b.maskedValue=this._maskValue(b);b.maskedValue=this._addNegativeSymbol(b.maskedValue,b);b.maskedValue=this._addCurrencySymbol(b.maskedValue,b);b.maskedValue!=b.$this.val()&&(b.$this.val(b.maskedValue),
this._setRange(b._this,b.maskedValue.length-b.charsFromRight));b.completedZero=!1;this._autoTab(b);return!0},_onPaste:function(a,b){return this._onKeyUp(a,b)},_preparePasteEvent:function(a){setTimeout(function(){a.data.element._prepareEvent(a)},1)},_prepareEvent:function(a){var b=a.data.element,c=a.data.settings;c._this=a.target;c.$this=f(c._this);c.pressedKey=b._getPressedKey(a);c.pressedChar=String.fromCharCode(c.pressedKey);c.originalValue=c.$this.val();"select"==c._this.type||"select-one"==c._this.type||
"select-multiple"==c._this.type||"checkbox"==c._this.type||"radio"==c._this.type?(c.range=0,c.charsFromRight=0):(c.range=b._getRange(c._this,a),c.charsFromRight=c.originalValue.length-c.range.end);a.data.callEvent.call(b,a,c)},_addCurrencySymbol:function(a,b){return""==a?"":"currency"!=b.datatype?a:"left"==b.currencyPosition?b.currencySymbol+" "+a:a+" "+b.currencySymbol},_addNegativeSymbol:function(a,b){if(!b.isNumeric||!b.allowNegative)return a;if(b.isNegative)return b.$this.attr("maxlength",b.maxLength+
1),"-"+a;b.$this.attr("maxlength",b.maxLength);return a},_applyMask:function(a,b){var c=b.split(""),d="",e=this._getMaskArray(a,b.length);"left"==a.maskOrientation&&(e.reverse(),c.reverse());for(var g=a.invalidCount=0;g<e.length;g++){if(-1<f.inArray(e[g],a.maskCharsArray))d+=e[g];else{for(bGetChar=!0;bGetChar;)sChar=c.shift(),this._testChar(sChar,e[g])?bGetChar=!1:(a.invalidCount++,sChar=""),0==c.length&&(bGetChar=!1);d+=sChar}if(0==c.length)break}"left"==a.maskOrientation&&(d=this._strReverse(d));
return this._matchCase(a,d)},_checkCurrencyRange:function(a){if("currency"==a.datatype&&""!=a.maskedValue){var b=this._getRange(a._this,null);if("right"==a.currencyPosition){var c=a.maskedValue.length-a.currencySymbol.length-1;b.end>c&&this._setRange(a._this,c)}}},_checkDecimalsPress:function(a){if(a.manualDecimals){var b=a.originalValue.indexOf(a.decimalSep),c=a.pressedChar==a.decimalSep,d=48<=a.pressedKey&&57>=a.pressedKey,e=a.originalMask.split(a.decimalSep);d&&-1==b?a.maskList=e[0]:c&&(-1==b||
b>=a.range.start&&b<=a.range.end)?(b=a.originalValue.length-a.range.end,a.forceMask=!0,a.forceDecimalPos=!0,a.maskList=0==b?e[0]+a.decimalSep:b<a.precision?e[0]+a.decimalSep+e[1].substr(0,b):a.originalMask):d&&a.range.start==a.range.end&&a.range.end>b?(b=a.originalValue.length-b,a.forceMask=!0,a.maskList=a.precision==b?a.originalMask:e[0]+a.decimalSep+e[1].substr(0,b)):d&&a.range.start==a.range.end&&a.range.end<=b?(b=a.originalValue.length-b,a.forceMask=!0,a.maskList=a.precision==b-1?a.originalMask:
e[0]+a.decimalSep+e[1].substr(0,b-1)):!d&&-1<b&&(b=a.originalValue.length-b,a.forceMask=!0,a.maskList=a.precision==b?a.originalMask:e[0]+a.decimalSep+e[1].substr(0,b));a.maxLength=a.maskList.length}},_completeDecimal:function(a){if(!(1>a.precision)){var b=a.$this.val();b=this._removeCurrencySymbol(b,a);if(""!=b)if(-1==b.indexOf(a.decimalSep))b+=a.decimalSep+this._strRepeat("0",a.precision);else{var c=b.split(a.decimalSep);c[1].length<a.precision&&(c[1]+=this._strRepeat("0",a.precision-c[1].length),
b=c.join(a.decimalSep))}b=this._addCurrencySymbol(b,a);a.$this.val(b)}},_createDecimalMask:function(a,b,c,d,e){var f="";0<e&&(a-=e,f=c+this._strRepeat("9",e));return this._createIntegerMask(a,b,d)+f},_createDateMask:function(a,b){var c=[];a=a.replace(/dd/i,"d").replace(/mm/i,"m").replace(/yyyy/i,"y").replace(/aaaa/i,"y");for(var d=0;d<a.length;d++)switch(a.charAt(d)){case "d":case "m":c.push("99");break;case "y":c.push("9999")}return c.join(b)},_createDateTimeMask:function(a,b,c){a=a.split(";");return this._createDateMask(a[0],
b)+" "+this._createTimeMask(a[1],c)},_createIntegerMask:function(a,b,c){var d=[];if(1==b)for(b=Math.floor(a/3),a%=3,0!=a&&d.push(this._strRepeat("9",a)),a=0;a<b;a++)d.push("999");else if(2==b)4>a?d.push(this._strRepeat("9",a)):(d.push(this._strRepeat("9",a-3)),d.push(this._strRepeat("9",3)));else if(3==b)if(4>a)d.push(this._strRepeat("9",a));else{b=Math.floor((a-3)/2);a=(a-3)%2;0!=a&&d.push(this._strRepeat("9",a));for(a=0;a<b;a++)d.push("99");d.push(this._strRepeat("9",3))}return d.join(c)},_createTimeMask:function(a,
b){var c=[];a=a.replace(/hh/i,"h").replace(/ii/i,"i").replace(/ss/i,"s");for(var d=0;d<a.length;d++)switch(a.charAt(d)){case "h":case "i":case "s":c.push("99")}return c.join(b)},_filterUnallowedChars:function(a,b){if(""==a.allowedChars)return this._matchCase(a,b);for(var c="",d=0;d<b.length;d++)-1<a.allowedChars.indexOf(b.charAt(d).toLowerCase())&&(c+=b.charAt(d));return this._matchCase(a,c)},_getLongestMaskSize:function(a,b){for(var c=b.split(""),d=a.split(";"),e=0,f=0;f<d.length;f++)e=Math.max(e,
this._removeMaskChars(d[f],c).length);return e},_getCleanValue:function(a){var b=this._removeMaskChars(a.newValue,a.maskCharsArray);if("integer"==a.datatype)b=this._removeZeros(a,b,0);else if("decimal"==a.datatype||"currency"==a.datatype)b=this._removeZeros(a,b,a.precision);return b},_getMaskArray:function(a,b){var c=""!=a.maskList?a.maskList.split(";"):[];a.mask="";if(1==c.length)a.mask=c[0];else if(1<c.length)for(var d=0;d<c.length;d++)sCleanMask=this._removeMaskChars(a.mask,a.maskCharsArray),sCleanMaskI=
this._removeMaskChars(c[d],a.maskCharsArray),""==a.mask?a.mask=c[d]:sCleanMask.length<sCleanMaskI.length&&sCleanMask.length<b&&(a.mask=c[d]);return a.mask.split("")},_getNewValue:function(a){return a.isSpecial?a.originalValue:a.originalValue.substr(0,a.range.start)+a.pressedChar+a.originalValue.substr(a.range.end)},_maskValue:function(a){if("currency"==a.datatype&&!a.manualDecimals&&a.newValue.length>a.maxLength-a.currencySymbol.length-1){var b=this._removeCurrencySymbol(a.originalValue,a);return b=
this._removeNegativeSymbol(b,a)}if(a.newValue.length>a.maxLength&&0==a.newValue.substr(0,1)&&("integer"==a.datatype||"decimal"==a.datatype))a.newValue=a.newValue.substr(1);else if(a.newValue.length>a.maxLength)return b=this._removeCurrencySymbol(a.originalValue,a),b=this._removeNegativeSymbol(b,a);b=this._getCleanValue(a);return""==b?"":"text"==a.datatype?this._filterUnallowedChars(a,b):this._applyMask(a,b)},_matchCase:function(a,b){if(""==b||""==a.lettersCase)return b;var c="";if("first"==a.lettersCase){for(var d=
0;d<b.length&&" "==b.charAt(d);)c+=b.charAt(d++);d<b.length&&(c+=b.charAt(d).toUpperCase()+b.substr(d+1))}else if("upper"==a.lettersCase||"lower"==a.lettersCase)for(d=0;d<b.length;d++)c+="upper"==a.lettersCase?b.charAt(d).toUpperCase():b.charAt(d).toLowerCase();else if("words"==a.lettersCase){c=b.split(" ");for(d=0;d<c.length;d++)0<c[d].length&&(c[d]=c[d].charAt(0).toUpperCase()+c[d].substr(1));c=c.join(" ")}return c},_removeCurrencySymbol:function(a,b){if("currency"!=b.datatype)return a;if("left"==
b.currencyPosition){if(a.substr(0,b.currencySymbol.length+1)==b.currencySymbol+" ")return a.substr(b.currencySymbol.length+1);if(a.substr(0,b.currencySymbol.length)==b.currencySymbol)return a.substr(b.currencySymbol.length)}else if("right"==b.currencyPosition){var c=a.substr(a.length-b.currencySymbol.length-2),d=c.indexOf("-");-1<d&&(a=a.substr(0,a.length-b.currencySymbol.length-2)+"-"+c.substr(0,d)+c.substr(d+1));if(a.substr(a.length-b.currencySymbol.length-1)==b.currencySymbol+" ")return a.substr(0,
a.length-b.currencySymbol.length-2);if(a.substr(a.length-b.currencySymbol.length)==b.currencySymbol)return a.substr(0,a.length-b.currencySymbol.length-1)}c=a.split("");d=(b.currencySymbol+" ").split("");sNew="";for(var e=0;e<c.length;e++)-1==f.inArray(a.charAt(e),d)&&(sNew+=a.charAt(e));return sNew},_removeNegativeSymbol:function(a,b){if(!b.isNumeric)return a;for(var c=!1;-1!=(iPos=a.indexOf("-"));)a=a.substr(0,iPos)+a.substr(iPos+1),c=!c;b.isNegative=b.onlyNegative?!0:c||"-"!=b.pressedChar?c&&"-"==
b.pressedChar?!1:c&&"+"==b.pressedChar?!1:c:!0;return a},_removeMaskChars:function(a,b){for(var c="",d=0;d<a.length;d++)-1==f.inArray(a.charAt(d),b)&&(c+=a.charAt(d));return c},_removeZeros:function(a,b,c){if(""==b)return b;for(;"0"==b.substr(0,1)&&c+1<b.length;)b=b.substr(1);a.completedZero=!1;!a.manualDecimals&&0<c&&c+1>b.length&&(b=this._strRepeat("0",c+1-b.length)+b,a.completedZero=!0);return b},_testChar:function(a,b){return"9"==b?(oRegExp=/[0-9]/,oRegExp.test(a)):"a"==b?(oRegExp=/[a-zA-Z]/,
oRegExp.test(a)):"*"==b?(oRegExp=/[0-9a-zA-Z]/,oRegExp.test(a)):a==b},_applyWatermark:function(a,b){null!=b&&(""==a.val()?(a.hide(),b.show()):(a.show(),b.hide()))},_createWatermark:function(a,b,c){""!=c.watermark&&(c.$clone=a.clone(),b=c.$clone,"password"==b[0].type&&(b[0].type="text"),b.attr("name","sc_clone_"+a.attr("name")).val(c.watermark).addClass(c.watermarkClass).insertAfter(a).bind("focus",{element:a,clone:b},this._removeWatermark),this._applyWatermark(a,b))},_removeWatermark:function(a){var b=
a.data.element;a=a.data.clone;null!=a&&(a.hide(),b.show().focus().trigger("focus"))},_autoTab:function(a){if(a.autoTab&&!a.isSpecial&&16!=a.pressedKey){if("decimal"==a.datatype||"currency"==a.datatype){var b=a.maskedValue.indexOf(a.decimalSep);if(-1==b||a.maskedValue.substr(b+1).length<a.precision)return}"mask"==a.datatype&&a.longestMask<=this._removeMaskChars(a.maskedValue,a.maskChars.split("")).length?this._goToNextElement(a):"mask"!=a.datatype&&!a.isNegative&&a.maskedValue.length>=a.maxLength?
this._goToNextElement(a):"mask"!=a.datatype&&a.isNegative&&a.maskedValue.length-1>=a.maxLength&&this._goToNextElement(a)}},_getNextElement:function(a){var b=a._this;a=b.form.elements;for(var c=f.inArray(b,a)+1;c<a.length;c++){var d=f(a[c]);if(this._isValidInput(d))return d}var e=document.forms;for(b=f.inArray(b.form,e)+1;b<e.length;b++)for(a=e[b].elements,c=0;c<a.length;c++)if(d=f(a[c]),this._isValidInput(d))return d;return null},_goToNextElement:function(a){return"textarea"==a._this.type?!1:($oNext=
this._getNextElement(a))?($oNext.focus(),this._isNotText(a._this)):!1},_isValidInput:function(a){a=a.get(0);return 0>=a.offsetHeight||0>=a.offsetWidth||a.disabled||"file"==a.type?!1:!0},_getMaxLength:function(a,b){var c=0;if(""!=a.maskList)for(var d=a.maskList.split(";"),e=0;e<d.length;e++)c=Math.max(c,d[e].length);if(0==c){if(0<a.maxLength)return a.maxLength;if(b.attr("maxlength")&&0<b.attr("maxlength"))return b.attr("maxlength");if(b.attr("size")&&0<b.attr("size"))return b.attr("size")}"currency"==
a.datatype&&(c+=a.currencySymbol.length+1);return c},_getPressedKey:function(a){return a.charCode||a.keyCode||a.which},_getRange:function(a,b){if(!f.browser.msie)return{start:a.selectionStart,end:a.selectionEnd};var c={start:0,end:0};if("textarea"==a.type&&"blur"!=b.type){var d=f(a).getSelection();c.start=d.start;c.end=d.end}else d=document.selection.createRange(),c.start=0-d.duplicate().moveStart("character",-1E5),c.end=c.start+d.text.length;return c},_isEnterTab:function(a,b){return a.enterTab?
"enter"==b?13==a.pressedKey:9==a.pressedKey:!1},_isEnterSubmit:function(a,b){return a.enterSubmit?"enter"==b?13==a.pressedKey:9==a.pressedKey:!1},_isNotText:function(a){return"select"==a.type||"select-one"==a.type||"select-multiple"==a.type||"checkbox"==a.type||"radio"==a.type},_isSpecialEnterTab:function(a){return this._isEnterTab(a,"enter")&&this._isNotText(a)},_loadOptions:function(a){if(a.attr("alt"))eval("var oMetadata = "+a.attr("alt"));else var b={};b=f.extend({},this.defaults,b);b=this._setDatatypeSettings(b);
b.maxLength=this._getMaxLength(b,a);b.maskCharsArray=b.maskChars.split("");return b},_setDatatypeSettings:function(a){"currency"==a.datatype&&""==a.currencySymbol&&(a.datatype="decimal");"currency"!=a.datatype&&"decimal"!=a.datatype||0!=a.precision||(a.datatype="integer");"currency"!=a.datatype&&"decimal"!=a.datatype&&(a.manualDecimals=!1);switch(a.datatype){case "integer":"left"!=a.alignment&&"center"!=a.alignment&&"justify"!=a.alignment&&(a.alignRight=!0);a.isNumeric=!0;a.maskList=this._createIntegerMask(a.maxLength,
a.thousandsFormat,a.thousandsSep);a.maskOrientation="left";a.maskChars=a.thousandsSep;a.originalMask=a.maskList;break;case "decimal":"left"!=a.alignment&&"center"!=a.alignment&&"justify"!=a.alignment&&(a.alignRight=!0);a.isNumeric=!0;a.maskList=this._createDecimalMask(a.maxLength,a.thousandsFormat,a.decimalSep,a.thousandsSep,a.precision);a.maskOrientation="left";a.maskChars=a.decimalSep+a.thousandsSep;a.originalMask=a.maskList;break;case "currency":"left"!=a.alignment&&"center"!=a.alignment&&"justify"!=
a.alignment&&(a.alignRight=!0);a.isNumeric=!0;a.maskList=this._createDecimalMask(a.maxLength,a.thousandsFormat,a.decimalSep,a.thousandsSep,a.precision);a.maskOrientation="left";a.maskChars=a.decimalSep+a.thousandsSep+a.currencySymbol+" ";a.originalMask=a.maskList;break;case "datetime":a.allowNegative=!1;a.maskList=this._createDateTimeMask(a.dateFormat,a.dateSep,a.timeSep);a.maskChars=a.dateSep+a.timeSep+" ";a.originalMask=a.maskList;break;case "date":a.allowNegative=!1;a.maskList=this._createDateMask(a.dateFormat,
a.dateSep);a.maskChars=a.dateSep;a.originalMask=a.maskList;break;case "time":a.allowNegative=!1;a.maskList=this._createTimeMask(a.timeFormat,a.timeSep);a.maskChars=a.timeSep;a.originalMask=a.maskList;break;case "mask":a.allowNegative=!1;a.maskList=a.maskList;a.longestMask=this._getLongestMaskSize(a.maskList,a.maskChars);a.originalMask=a.maskList;break;case "text":a.allowedChars=a.allowedChars.toLowerCase();a.maskChars="";break;default:a.allowNegative=!1,a.maskList=this.masks[a.datatype]?this.masks[a.datatype]:
"",a.originalMask=a.maskList}return a},_setRange:function(a,b,c){"undefined"==typeof c&&(c=b);a.setSelectionRange?a.setSelectionRange(b,c):(a=a.createTextRange(),a.collapse(),a.moveStart("character",b),a.moveEnd("character",c-b),a.select())},_strRepeat:function(a,b){return Array(b+1).join(a)},_strReverse:function(a){return a.split("").reverse().join("")},_debug:function(a){n=f("#id-debug").html();f("#id-debug").html(""==n?a:n+"\n"+a)},masks:{cep:"99.999-999",cpf:"999.999.999-99",cnpj:"99.999.999/9999-99",
ssn:"999-99-9999",cc:"9999 9999 9999 9999"},defaults:{datatype:"text",maxLength:0,alignment:"",alignRight:!1,enterTab:!1,enterSubmit:!1,selectOnFocus:!0,lettersCase:"",mask:"",maskChars:"(){}[].,;:-+/ ",maskList:"",maskOrientation:"right",allowedChars:"",decimalSep:".",thousandsSep:",",precision:2,dateFormat:"mdy",dateSep:"/",timeFormat:"his",timeSep:":",currencySymbol:"",currencyPosition:"left",allowNegative:!0,onlyNegative:!1,manualDecimals:!1,thousandsFormat:1,autoTab:!1,watermark:"",watermarkClass:"",
$clone:null,completedZero:!1,invalidCount:0,inputFocusValue:"",isNegative:!1,isNumeric:!1,pressedMinus:!1,hasDecimal:-1,originalMask:"",forceMask:!1,forceDecimalPos:!1,longestMask:0},specialKeys:{8:"backspace",9:"tab",13:"enter",16:"shift",17:"control",18:"alt",27:"esc",33:"page up",34:"page down",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",93:"menu",116:"f5",123:"f12",224:"command"}}})(jQuery);